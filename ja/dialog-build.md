---

copyright:
  years: 2015, 2019
lastupdated: "2019-02-28"

subcollection: assistant

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:deprecated: .deprecated}
{:important: .important}
{:note: .note}
{:tip: .tip}
{:pre: .pre}
{:codeblock: .codeblock}
{:screen: .screen}
{:javascript: .ph data-hd-programlang='javascript'}
{:java: .ph data-hd-programlang='java'}
{:python: .ph data-hd-programlang='python'}
{:swift: .ph data-hd-programlang='swift'}
{:table: .aria-labeledby="caption"}

# ダイアログの作成
{: #dialog-build}

ダイアログを作成するには、{{site.data.keyword.conversationshort}} ツールを使用します。
{: shortdesc}

## ダイアログの作成
{: #dialog-build-task}

ダイアログを作成するには、以下の手順を実行します。

1.  **「Dialog」**タブをクリックしてから、**「Create」**をクリックします。

    ダイアログ・ビルダーを初めて開いたときに、次のノードが自動で作成されます。

    - **Welcome**: 最初のノード。 初めてサービスを使用したユーザーに表示されるあいさつが含まれています。 あいさつは編集できます。

    このノードは、ユーザーが開始したダイアログ・フローではトリガーされません。例えば、Facebook や Slack などのチャネルとの統合で使用されるダイアログは、`welcome` という特殊条件を持つノードをスキップします。詳しくは、[ダイアログの初期化](/docs/services/assistant?topic=assistant-dialog-start)を参照してください。
    {: note}

    - **Anything else**: 最終ノード。 ユーザー入力が認識されないときにユーザーへの応答に使用されるフレーズが含まれています。 用意されている応答を置き換えたり、同じような意味の応答を追加してダイアログにバリエーションを追加したりできます。 また、サービスから各応答を定義順序どおりに返すか、ランダムな順序で返すかを選択することもできます。
1.  ダイアログ・ツリーにノードを追加するには、**Welcome** ノードの「**その他**」アイコン ![その他アイコン](images/kabob.png) をクリックして、「**ノードを下に追加**」を選択します。
1.  満たされたときにサービスをトリガーしてノードを処理する条件を入力します。

    条件の定義を開始すると、ボックスが表示され、オプションが示されます。 次のいずれかの文字を入力し、表示されたオプションのリストから値を選択できます。

    <table>
    <caption>条件ビルダーの構文</caption>
    <tr>
      <th>Character</th>
      <th>これらの成果物タイプの定義済みの値がリストされます。</th>
    </tr>
    <tr>
      <td>`#`</td>
      <td>インテント</td>
    </tr>
    <tr>
      <td>`@`</td>
      <td>エンティティー</td>
    </tr>
    <tr>
      <td>`@{entity-name}:`</td>
      <td>{entity-name} の値</td>
    </tr>
    <tr>
      <td>`$`</td>
      <td>ダイアログ内の他の場所で定義または参照したコンテキスト変数</td>
    </tr>
    </table>

    新しいインテント、エンティティー、エンティティー値、またはコンテキスト変数を作成するには、それを使用する新しい条件を定義します。 この方法で成果物を作成する場合は、成果物を完全に作成するために必要なその他の手順 (インテントのサンプル発話の定義など) に戻り、確実に完了させてください。

    複数の条件に基づいてトリガーするノードを定義するには、条件を 1 つ入力した後に、その隣にある正符号 (+) アイコンをクリックします。 複数の条件に `AND` 演算子の代わりに `OR` 演算子を適用する場合は、フィールドの間に表示される `and` をクリックして、演算子タイプを変更します。 AND 演算は OR 演算より前に実行されますが、括弧を使用するとその順序を変更できます。 例: `$isMember:true AND ($memberlevel:silver OR $memberlevel:gold)`

    定義する条件は、2,048 文字未満でなければなりません。

    条件の値をテストする方法について詳しくは、[条件](/docs/services/assistant?topic=assistant-dialog-overview#dialog-overview-conditions)を参照してください。
1.  **オプション**: このノードでユーザーから複数の情報を収集するには、「**カスタマイズ**」をクリックし、「**スロット**」を有効にします。 詳しくは、[スロットを使用した情報の収集](/docs/services/assistant?topic=assistant-dialog-slots)を参照してください。
1.  応答を入力します。
    - 本サービスが応答としてユーザーに表示するテキストまたはマルチメディア要素を追加します。
    - 特定の条件に基づいて、さまざまな応答を定義する場合は、**「カスタマイズ (Customize)」**をクリックし、**「複数の応答 (Multiple responses)」**を有効にします。
    - 条件付き応答、リッチ応答、応答に種類を追加する方法については、[応答](/docs/services/assistant?topic=assistant-dialog-overview#dialog-overview-responses)を参照してください。

1.  現行ノードが処理された後に行う処理を指定します。 次のオプションから選択できます。

    - **ユーザー入力を待機する (Wait for user input)**: ユーザーから新しい入力が提供されるまで、サービスは一時停止します。
    - **ユーザー入力をスキップする (Skip user input)**: サービスは直接、最初の子ノードにジャンプします。 このオプションは、現行ノードに少なくとも 1 つの子ノードがある場合にのみ使用可能です。
    - **ジャンプする (Jump to)**: サービスは、指定されたノードを処理してダイアログを続けます。 サービスでターゲット・ノードの条件を評価するか、ターゲット・ノードの応答まで直接スキップするかを選択できます。 詳しくは、[Jump to アクションの構成](/docs/services/assistant?topic=assistant-dialog-overview#dialog-overview-jump-to-config)を参照してください。

1.  **オプション**: 実行時にノード選択のセットがユーザーに示されてユーザーの目的に最も合うものを選出するようユーザーが求められたときにこのノードが考慮されるようにするには、このノードが扱うユーザーの目的の簡略説明を**「external node name」**フィールドに追加します。例えば、*注文する* などです。

    ![プラス・プランとプレミアム・プランのみ](images/premium.png)*「external node name」*フィールドはプラス・プランとプレミアム・プランのユーザーにのみ表示されます。詳しくは、[明確化](/docs/services/assistant?topic=assistant-dialog-runtime#dialog-runtime-disambiguation)を参照してください。

1.  **オプション**: ノードに名前を付けます。

    ダイアログ・ノード名には、文字 (Unicode)、数字、スペース、下線、ハイフン、ピリオドを使用できます。

    ノードに名前を付けておくと、その用途がすぐにわかるため、最小化された状態のときにノードを簡単に見つけることができます。 名前を指定しなかった場合は、ノード条件が名前として使用されます。

1.  ノードを追加するには、ツリー内のノードを選択し、「**その他**」アイコン ![More icon](images/kabob.png) をクリックします。
    - 既存のノードの条件が満たされていない場合に次にチェックするピア・ノードを作成するには、「**ノードを下に追加**」を選択します。
    - 既存のノードの条件をチェックする前にチェックするピア・ノードを作成するには、「**ノードを上に追加**」を選択します。
    - 選択したノードの子ノードを作成するには、「**子ノードを追加**」を選択します。 子ノードはその親ノードの後に処理されます。
    - 現在のノードをコピーするには、**「重複」**を選択します。

    ダイアログ・ノードの処理順序については、[ダイアログの概要](/docs/services/assistant?topic=assistant-dialog-overview#dialog-overview-flow)を参照してください。
1.  ダイアログを作成したら、そのダイアログをテストします。
   詳しくは、[ダイアログのテスト](#dialog-build-test)を参照してください。

## ダイアログのテスト
{: #dialog-build-test}

ダイアログに変更を加える際に、ダイアログが入力にどのように応答するかをいつでもテストして確認できます。

「Try it out」ペインで送信する照会によって `/message` API 呼び出しが生成されますが、それらの API はログに記録されないので課金が発生しません。

1.  「Dialog」タブで、![Try it](images/ask_watson.png) アイコンをクリックします。
1.  チャット・ペインで、テキストを入力して Enter キーを押します。

    ダイアログのテストを開始する前に、最新の変更内容でシステムがトレーニングを完了していることを確認します。 システムがまだトレーニング中の場合は、*「Try it out」*ペインにメッセージが表示されます。
    {: tip}

    ![トレーニング・メッセージの画面キャプチャー](images/training.png)
1.  応答をチェックして、ダイアログが入力を正しく解釈して適切な応答を選択したかどうかを確認します。

    チャット・ウィンドウに、入力で認識されたインテントとエンティティーが示されます。

    ![テスト・ダイアログ出力の画面キャプチャー](images/test_dialog_output.png)
1.  ダイアログ・ツリー内のどのノードが応答をトリガーしたかを調べるには、その応答の隣にある **「場所」** ![場所](images/location.png) アイコンをクリックします。 まだ「ダイアログ」タブが表示されていない場合は、このタブを開きます。

    ソース・ノードがフォーカスされ、サービスがそのノードに至るまでたどったツリーの経路が強調表示されます。 新しいテスト入力を行うなど、別のアクションを実行するまで、経路は強調表示されたままです。
1.  コンテキスト変数の値を確認または設定するには、「**コンテキストを管理 (Manage context)**」リンクをクリックします。

    ダイアログに定義したコンテキスト変数がすべて表示されます。

    加えて、`$timezone` コンテキスト変数がリストされます。 「*Try it out*」ペインのユーザー・インターフェースは、Web ブラウザーからユーザーのロケール情報を取得し、`$timezone` コンテキスト変数の設定に使用します。 このコンテキスト変数により、ダイアログの対話テストでの時刻基準の処理が簡単になります。 ユーザー・アプリケーションでも同様に処理することを検討してください。 指定しなかった場合は、グリニッジ標準時 (GMT) が使用されます。

    変数を追加してその値を設定すると、テスト・ダイアログの次のターンでどのような応答が返されるかを確認できます。 この機能は、例えば、ユーザーから提供されたコンテキスト変数の値に応じて異なる応答を表示するようにダイアログが設定されている場合に役立ちます。

    1.  コンテキスト変数を追加するには、変数名を指定し、**Enter** キーを押します。
    1.  コンテキスト変数のデフォルト値を定義するには、リストに追加したコンテキスト変数を見つけて、その値を指定します。

    詳しくは、[コンテキスト変数](/docs/services/assistant?topic=assistant-dialog-runtime#dialog-runtime-context)を参照してください。

1.  ダイアログとの対話を続けて、どのような会話のフローになるかを確認します。
    - テスト発話を検索して再送信する場合は、上矢印キーを押すと、最近の入力を順番に確認することができます。
    - チャット・ペインから過去のテスト発話を削除し、最初からやり直すには、「**クリア**」リンクをクリックします。 この操作により、テストの発話と応答が削除されるだけでなく、ダイアログとの対話の結果として設定されたコンテキスト変数の値もクリアされます。 明示的に設定または変更したコンテキスト変数の値はクリアされません。

### 次の作業
{: #dialog-build-next-steps}

不適切なインテントまたはエンティティーが認識されていることがわかった場合は、インテントまたはエンティティーの定義を変更する必要があります。

インテントとエンティティーが正しく認識されているのに、ダイアログで正しくないノードがトリガーされる場合は、条件が正しく記述されていることを確認してください。

始めるにあたって役立つ可能性のあるヒントについては、[ダイアログの作成のヒント](/docs/services/assistant?topic=assistant-dialog-tips)を参照してください。

会話を機能させてユーザーを支援する準備ができたら、アシスタントをメッセージング・プラットフォームまたはカスタム・アプリケーションと統合します。[統合の追加](/docs/services/assistant?topic=assistant-deploy-integration-add)を参照してください。

## ダイアログ・ノードの制限
{: #dialog-build-node-limits}

スキルごとに作成できるダイアログ・ノードの数は、サービス・プランによって異なります。

| サービス・プラン     | スキルごとのダイアログ・ノード数     |
|------------------|---------------------------:|
| プレミアム          |                    100,000 |
| プラス             |                    100,000 |
| 標準         |                    100,000 |
| ライト             |                     100`*` |
{: caption="サービス・プランの詳細" caption-side="top"}

ツリーに定義済みの welcome ダイアログ・ノードと anything_else ダイアログ・ノードは合計に加算されます。

ツリーの深さの制限: 本サービスはダイアログ・ノードの子孫を 2,000 個までサポートします。ツールのパフォーマンスが最も良いのは 20 個以下の場合です。

`*` ライト・プランの制限は 2018 年 12 月 1 日に 25,000 個から 100 個に変更されました。制限が変更される前に作成されたサービス・インスタンスのユーザーは、2019 年 6 月 1 日までにプランをアップグレードするか、既存のサービス・インスタンスのスキルに含まれるダイアログを編集して、新しい制限要件を満たす必要があります。

ダイアログ・スキル内のダイアログ・ノードの数を調べるには、以下のいずれかを行います。

- ダイアログ・スキルがまだアシスタントに関連付けられていない場合は、ツールからそれをアシスタントに追加し、アシスタントのメインページからスキル・タイルを表示します。*trained data* セクションにダイアログ・ノードの数がリストされます。
- GET 要求を /dialog_nodes API エンドポイントに送信し、`include_count=true` パラメーターを組み込みます。以下に例を示します。

  ```curl
  curl -u "apikey:{apikey}" "https://gateway.watsonplatform.net/assistant/api/v1/workspaces/{workspace_id}/dialog_nodes?version=2018-09-20&include_count=true"
  ```

  応答の `pagination` オブジェクトの `total` 属性にダイアログ・ノードの数が含まれています。

予想より合計が大きいと思われる場合、ツールで作成するダイアログはツールによって JSON オブジェクトに変換されることが原因である可能性があります。単一ノードの一部のように見えるいくつかのフィールドは、実際には、基礎となる JSON オブジェクトでは別々のダイアログ・ノードとして構造化されています。

  - ノードとフォルダーはそれぞれ、独自のノードとして表されます。
  - 単一のダイアログ・ノードに関連付けられた条件付き応答はそれぞれ、個別のノードとして表されます。
  - スロット付きノードの場合、スロット、スロットの found 応答、スロットの not found 応答、スロット・ハンドラー、「prompt for everything」応答 (設定されている場合) はそれぞれ、個別のノードです。実際には、3 つのスロットがあるノード 1 つが 11 個のダイアログ・ノードに相当する場合があります。

## ダイアログの検索
{: #dialog-build-search}

ダイアログを検索して、特定の単語または句に言及する 1 つ以上のダイアログ・ノードを見つけることができます。

1.  「検索」アイコン ![「検索」アイコン](images/search_icon.png) を選択します。

1.  検索対象の語句を入力します。

    最初の検索時に索引が作成されます。ダイアログ・ノード内のテキストの索引が作成される間待つよう求められる場合があります。
    {: note}

検索語を含むノードと、それに対応する例が表示されます。 任意の結果を選択して、編集するために開きます。

  ![インテント検索の結果](images/search_dialog.png)

## ノード ID によるダイアログ・ノードの検索
{: #dialog-build-get-node-id}

ノード ID でダイアログ・ノードを検索できます。完全なノード ID を検索フィールドに入力します。次のいずれかの理由から、既知のノード ID に関連付けられているダイアログ・ノードを見つけなければならない場合があります。

- ログを確認していたら、ダイアログのセクションがノード ID で示されている。
- API メッセージ出力の `nodes_visited` プロパティーにリストされているノード ID を、ダイアログ・ツリーに表示されるノードにマップする必要がある。
- ダイアログ実行時のエラー・メッセージで、構文エラーが通知され、修正が必要なノードがノード ID で示されている。

ノード ID に基づいてノードを見つけ出すもう一つの方法は、以下の手順を実行する方法です。

1.  ツールの「ダイアログ」タブで、ダイアログ・ツリーの任意のノードを選択します。
1.  現在のノードで編集ビューが開いている場合は、編集ビューを閉じます。
1.  Web ブラウザーのロケーション・フィールドに、次の構文の URL が表示されます。

    `https://watson-conversation.ng.bluemix.net/space/instance-id/workspaces/workspace-id/build/dialog#node=node-id`

1.  この URL を編集し、現在の `node-id` の値を、探しているノードの ID に置き換え、新しい URL を送信します。
1.  必要に応じて、編集した URL をもう一度強調表示して再送信します。

ツールが最新表示され、指定したノード ID のダイアログ・ノードがフォーカスされます。 ノード ID が、スロット、Found スロット条件、Not found スロット条件、スロット・ハンドラー、または条件付き応答を表している場合は、スロットまたは条件付き応答が定義されているノードがフォーカスされ、対応するモーダルが表示されます。

それでもノードが見つからない場合は、ダイアログ・スキルをエクスポートし、JSON エディターを使用してスキルの JSON ファイルを検索します。
{: tip}

## ダイアログ・ノードのコピー
{: #dialog-build-copy-node}

ノードを複製し、ダイアログ・ツリーの直下に、そのノードの正確なコピーをピア・ノードとして作成できます。 コピーされたノード自体の名前は、元のノードと同じ名前になりますが、名前の末尾に `- copy`*`n`* が付加されます。*`n`* は 1 から始まる番号です。同じノードを何度も複製すると、名前の中の *`n`* が、コピーするたびに 1 ずつ増分するので、コピーを区別するのに役立ちます。 ノードに名前がない場合は、`copy`*`n`* という名前になります。

子ノードを持つノードを複製すると、子ノードも複製されます。 コピーされた子ノードは、元の子ノードと同じ名前になります。 コピーされた子ノードを元の子ノードと区別するには、親ノード名の `copy` の表記を確認するしかありません。

1.  コピーしたいノードの**「その他」** ![「その他」アイコン](images/kabob.png) アイコンをクリックし、次に**「重複」**を選択します。
1.  コピーしたノードの名前を変更したり条件を編集したりして、区別できるようにすることを検討してください。

## ダイアログ・ノードの移動
{: #dialog-build-move-node}

作成した各ノードを、ダイアログ・ツリー内の他の場所に移動することができます。

以前に作成したノードをフローの別の領域に移動して、会話を変更しなければならない場合があります。 ノードを移動して、別のブランチの兄弟またはピアにすることができます。

1.  移動するノードで「**その他**」アイコン ![More icon](images/kabob.png) をクリックし、「**移動**」を選択します。
1.  ツリー内でこのノードの近くにある移動先ノードを選択します。 このノードを移動先ノードの前に配置するか、後に配置するか、または、移動先ノードの子ノードにするかを選択します。

## フォルダーを使用したダイアログの編成
{: #dialog-build-folders}

複数のダイアログ・ノードを 1 つのフォルダーに追加して、ダイアログ・ノードをグループ化できます。 ノードをグループ化する理由は、以下のように多数あります。

- 対処するサブジェクトが似ているノードをまとめて見つけやすくする。 例えば、ユーザー・アカウントについての質問に対処するノードを*「ユーザー・アカウント」*フォルダーにまとめ、支払い関連の照会を処理するノードを*「支払い」*フォルダーにまとめます。
- 特定の条件が満たされた場合にのみダイアログに処理させる一連のノードをグループ化する。 例えば、`$isPlatinumMember` などの条件を使用して、現行ユーザーに特別なサービスを受ける資格がある場合にのみ処理する、特別なサービスを提供するノードをまとめたりします。
- ノードを操作する間、ランタイム環境からノードを隠す。 `false` 条件を指定したフォルダーにノードを追加して、それらのノードが処理されないようにします。

フォルダーの以下の特性によって、フォルダー内のノードが処理される方法が決まります。

- 条件: 条件が指定されていない場合、本サービスはフォルダー内のノードを直接処理します。条件が指定されている場合、本サービスは最初にフォルダー条件を評価して、その中のノードを処理するかどうかを決定します。
- カスタマイズ: フォルダーに適用した構成設定は、フォルダー内のノードに継承されます。 例えば、フォルダーの脱線設定を変更すると、その変更はフォルダー内のすべてのノードに継承されます。
- ツリー階層: フォルダー内のノードは、フォルダーがダイアログ・ツリーにルート・レベルで追加されたか子レベルで追加されたかによって、ルート・ノードまたは子ノードとして扱われます。 ルート・レベルのフォルダーに追加したルート・レベル・ノードは、ルート・ノードとして機能し続けます。そのため、フォルダーの子ノードなどになることはありません。 ただし、ルート・レベルのノードを別のノードの子であるフォルダーに移動すると、そのルート・ノードはその別のノードの子になります。

フォルダーは、ノードが評価される順序に影響を与えません。 ノードは変わらず最初から最後まで処理されます。 本サービスは、ツリーを下に向かって評価する時にフォルダーを検出すると、そのフォルダーに条件がない場合またはその条件が true である場合に、そのフォルダー内の最初のノードをただちに処理した後、そこから引き続き順番にツリーを下に移動していきます。フォルダーにフォルダー条件がない場合、そのフォルダーは本サービスにとっては透過的なものになるので、そのフォルダー内の各ノードはツリー内の他の個別のノードのように扱われます。

### フォルダーの追加
{: #dialog-build-folders-add}

フォルダーをダイアログ・ツリーに追加するには、次の手順を実行します。

1.  **「ダイアログ (Dialog)」**タブのツリー・ビューで、**「フォルダーの追加 (Add folder)」**をクリックします。

    フォルダーは、ダイアログ・ツリーの最後の **Anything else** ノードの直前に追加されます。 ツリー内の既存のノードを選択していた場合は、選択したノードの下に追加されます。

    フォルダーをツリーの任意の場所に追加する場合は、その場所のすぐ上のノードで、**「その他」** ![「その他」アイコン](images/kabob.png)アイコンをクリックし、**「フォルダーの追加 (Add folder)」**を選択します。

    既存のダイアログ・ブランチ内の子ノードの下にフォルダーを追加できます。 その場合は、子ノードで**「その他」** ![「その他」アイコン](images/kabob.png)アイコンをクリックし、**「フォルダーの追加 (Add folder)」**を選択します。

    フォルダーが編集ビューで開かれます。

1.  **オプション**: フォルダーに名前を付けます。

1.  **オプション**: フォルダーの条件を定義します。

    条件を指定しない場合は `true` が使用されます。これは、フォルダー内のノードが常に処理されることを意味します。

1.  ダイアログ・ノードをフォルダーに追加します。

    - 既存のダイアログ・ノードをフォルダーに追加するには、それらをフォルダーに一度に 1 つずつ移動する必要があります。

      移動するノードで、**「その他」** ![「その他」アイコン](images/kabob.png) アイコンをクリックし、**「移動」**を選択してから、フォルダーをクリックします。 移動先ターゲットとして**「フォルダー (To folder)」**を選択します。

      ノードを移動すると、フォルダー内のツリーの先頭に追加されます。 したがって、例えば、連続するルート・ダイアログ・ノードの順序を保持するには、まず、最後のノードから移動を開始します。
      {: tip}

    - 新規ダイアログ・ノードをフォルダーに追加するには、**「その他」** ![「その他」アイコン](images/kabob.png) アイコンをクリックし、**「ノードをフォルダーに追加 (Add node to folder)」**を選択します。

      ダイアログ・ノードがフォルダー内のダイアログ・ツリーの最後に追加されます。

### フォルダーの削除
{: #dialog-build-folders-delete}

フォルダーのみを削除することも、フォルダーとその中のすべてのダイアログ・ノードを削除することもできます。

フォルダーを削除するには、以下の手順を実行します。

1.  **「Dialog」**タブのツリー・ビューから、削除するフォルダーを見つけます。

1.  フォルダーの**「その他」** ![「その他」アイコン](images/kabob.png) アイコンをクリックし、**「削除」**を選択します。

1.  以下のいずれかを実行します。

    - フォルダーのみを削除し、フォルダー内のダイアログ・ノードを保持するには、**「フォルダー内のノードを削除 (Delete the nodes inside the folder)」**チェック・ボックスを選択解除し、**「はい、削除します (Yes, delete it)」**をクリックします。
    - フォルダーと、その中のすべてのダイアログ・ノードを削除するには、**「はい、削除します (Yes, delete it)」**をクリックします。

フォルダーのみを削除した場合は、そのフォルダーが以前に存在していたダイアログ・ツリー内の場所に、フォルダーに含まれていたノードが表示されます。
